# PEP-13: Shadow Metadata Storage



* Author(s): Colin Smith
* Contact: colin.smith@wisc.edu
* Status: Draft
* Type: Application
* Created: 2024-12-17
* Reviewed:
* Final:


## Introduction

Storing Shadow Metadata content after it has been generated is important for efficient retrieval by the diverse applications that may consume it. This PEP proposes a storage mechanism and associated schema for this purpose.

This PEP addresses an open issue in [PEP-12: Shadow Metadata Overview](peps/pep-12.md).


## Issue Statement

One of the components of Shadow Metadata is determining how it will be stored after creation. This content may sometimes be generated by algorithms that can be rerun quickly to recreate the metadata. In such cases, storage might seem unnecessary. However, other scenarios make regeneration non-trivial, such as manual semantic annotation or computationally expensive AI-generated content.

Additionally, ancillary information associated with Shadow Metadata, such as provenance or update history, can help assess the quality and relevance of the content. Storing Shadow Metadata in a database ensures accessibility for applications that need it and supports efficient querying and processing.

The format of Shadow Metadata has implications for the database selected to store it. Current thinking is to represent Shadow Metadata as XML-formatted text conforming to the EML 2.2.0 standard, which can be integrated with EML documents or converted to other formats. Selecting a database that supports the required queries and retrieval processes is critical.

A schema is also necessary to define the structure and semantics of the database fields, enabling validation, parsing, and content consistency. Key schema objectives include:



1. Identifying the subject, such as the original EML document and the elements it references.
2. Defining predicates that describe the relationship between the subject and the Shadow Metadata content, e.g., whether the content replaces or supplements the original data.
3. Representing the Shadow Metadata content itself as the object.
4. Including additional fields to aid management and application processing.


## Proposed Solution


### Database Type

Given the data types expected for Shadow Metadata, a relational database is a suitable choice. An example candidate database is SQLite.

However, storing XML content introduces additional considerations. While XML content can be stored as a string in database fields, using a database that supports XML-native types enables features like XPath querying, which may be advantageous. An option for such a database is PostgreSQL.


### Database Schema

The Shadow Metadata database schema should integrate effectively with EML metadata and support consuming applications. Each Shadow Metadata record should represent a single piece of information, with related records forming a Shadow Metadata document or database.

The schema adopts an RDF-like approach, using:



* **Subject**: The original EML content the Shadow Metadata references.
* **Predicate**: The relationship between the subject and object.
* **Object**: The Shadow Metadata content.

Additional properties provide context and management support. Below are the proposed fields:


#### Subject-Related Fields:



* `package_id`: Identifier for the EML document containing the referenced element. E.g., `knb-lter-ntl.324.22`.
* `environment`: The EDI environment where the `package_id` exists (`development`, `staging`, or `production`).
* `xpath`: The full XPath of the referenced subject element or attribute, enabling precise location in the EML document. For new content, the XPath may point to a non-existent element to be created. E.g., `/eml:eml/dataset/dataTable[21]/attributeList/attribute[4]`.


#### Predicate-Related Fields:



* `predicate`: A human-readable label describing the subject-object relationship, e.g., `isReplacedBy` or `isCreatedBy`.
* `predicate_id`: A URI/IRI for machine-readable identification, referencing a vocabulary term or concept.


#### Object-Related Fields:



* `object`: The Shadow Metadata content, represented as a string. For example, serialized XML that can be processed by libraries like Python's lxml.


#### Additional-Related Fields:



* `author`: Identifier of the content's creator, such as an ORCiD for a data curator or a GitHub link for an algorithm.
* `datetime`: Timestamp of content creation in ISO 8601 format (`YYYY-MM-DD hh:mm:ss`).
* `comment`: Comments related to the annotation, useful for revisiting or reviewing the content later.


## Open Issues



1. **Managing XPaths for New Content**: XPaths for newly created elements in an EML document may change as the database evolves. How should these paths be managed? Is there a better approach?
2. **Predicate Vocabulary**: Is there an existing vocabulary we can reuse, or do we need to create one?
3. **Tooling for Deployment**: Developing a Python library to instantiate the database and validate content could promote consistent usage within the EDI ecosystem.


## References



* [PEP-12: Shadow Metadata Overview](peps/pep-12.md)